<template>
  <div class = "doctor-availability-container">
    <div class="doctor-availability">
      <div v-for="(times, date) in availability.availability" v-bind:key = "date">
        <div class = "availiability-date" v-if="times != null">
          <button v-on:click="showDetails(date)" >{{date}} </button>
        <ul>
          <div class="details" :class="date == active ? activeClass : 'hidden'">
            <button v-on:click="blockDate(date)">Block Entire Day </button>
           <li v-for="time in times" v-bind:key="time" >
            <button class="time-button" v-on:click="blockTime(time,date)">{{time}}</button>
          </li>
          </div>
        </ul>
        </div>
      </div>
      </div>
      <div class="set-availability">
        <form v-on:submit.prevent="createAvailability()">
        <input type="date" v-model="availabilityDate" />
       <select v-model="availabilityOpenTime">
          <option value="00:00:00">0:00</option>
          <option value="01:00:00">1:00</option>
          <option value="02:00:00">2:00</option>
          <option value="03:00:00">3:00</option>
          <option value="04:00:00">4:00</option>
          <option value="05:00:00">5:00</option>
          <option value="06:00:00">6:00</option>
          <option value="07:00:00">7:00</option>
          <option value="08:00:00">8:00</option>
          <option value="09:00:00">9:00</option>
          <option value="10:00:00">10:00</option>
          <option value="11:00:00">11:00</option>
          <option value="12:00:00">12:00</option>
          <option value="13:00:00">13:00</option>
          <option value="14:00:00">14:00</option>
          <option value="15:00:00">15:00</option>
          <option value="16:00:00">16:00</option>
          <option value="17:00:00">17:00</option>
          <option value="18:00:00">18:00</option>
          <option value="19:00:00">19:00</option>
          <option value="20:00:00">20:00</option>
          <option value="21:00:00">21:00</option>
          <option value="22:00:00">22:00</option>
          <option value="23:00:00">23:00</option>
          <option value="24:00:00">24:00</option>


        </select>

        <select v-model="availabilityCloseTime">
          <option value="00:00:00">0:00</option>
          <option value="01:00:00">1:00</option>
          <option value="02:00:00">2:00</option>
          <option value="03:00:00">3:00</option>
          <option value="04:00:00">4:00</option>
          <option value="05:00:00">5:00</option>
          <option value="06:00:00">6:00</option>
          <option value="07:00:00">7:00</option>
          <option value="08:00:00">8:00</option>
          <option value="09:00:00">9:00</option>
          <option value="10:00:00">10:00</option>
          <option value="11:00:00">11:00</option>
          <option value="12:00:00">12:00</option>
          <option value="13:00:00">13:00</option>
          <option value="14:00:00">14:00</option>
          <option value="15:00:00">15:00</option>
          <option value="16:00:00">16:00</option>
          <option value="17:00:00">17:00</option>
          <option value="18:00:00">18:00</option>
          <option value="19:00:00">19:00</option>
          <option value="20:00:00">20:00</option>
          <option value="21:00:00">21:00</option>
          <option value="22:00:00">22:00</option>
          <option value="23:00:00">23:00</option>
          <option value="24:00:00">24:00</option>
        </select>
        <button v-on:click="submitAvailability">Confirm Availability </button>
        <button type="submit">Update Selected Availability </button>
        </form>
      </div>
  
    
</div>
</template>

<script>
 import doctorService from "../services/DoctorService.js";

export default {

 
  name: "doctor-availability",
  
  data(){
    return{
      availabilityDate:"",
      availabilityOpenTime:"",
      availabilityCloseTime:"",

      newAvailability: {
        doctorId: this.$store.state.user.id,
        specificOpenHours: {
          
        },
        specificCloseHours: {
          
        }
      },
      activeClass: 'is-visible',
      active: null,
      availability:[]

      
    }
  },
  created(){
    const today = new Date();
    const currentMonth = today.getMonth()+1;
    const currentYear = today.getFullYear();
    this.updateAvailability(currentMonth,currentYear);
  },
    methods:{
    showDetails(date){
      if(this.active == date){
        this.active = null;
      } else{
        this.active = date;
      }
      
    
    },

    blockTime(time,date){
      window.alert(`you booked an appt at ${time} on ${date}`)
    },
    blockDate(date){
      window.alert(`you have blocked the ${date}`)
    },

    updateAvailability(month, year){
      doctorService.getAvailability(this.$store.state.user.id, month, year).then(
      response => {
       
          this.availability = response.data;
        
      }
    )

    },
    createAvailability(){
      this.newAvailability.specificOpenHours[this.availabilityDate] = this.availabilityOpenTime;
      this.newAvailability.specificCloseHours[this.availabilityDate] = this.availabilityCloseTime;
    },
    submitAvailability(){
    
      this.newAvailability.specificOpenHours[this.availabilityDate] = this.availabilityOpenTime;
      this.newAvailability.specificCloseHours[this.availabilityDate] = this.availabilityCloseTime;
      doctorService.addAvailability(this.newAvailability.doctorId,this.newAvailability)
    }

  },
  watch:{
    availabilityMonth: function(newMonth){
      this.updateAvailability(newMonth,this.availabilityYear)
    }
    
  },

  computed:{
      availabilityMonth(){
        return this.availabilityDate.substr(5,2);
      },
      availabilityYear(){
        return this.availabilityDate.substr(0,4);
      }

      
  }
 

  

}
</script>

<style>
.is-visible{
  display:show;
}

.doctor-availability-container{
  display: flex;
}

.hidden{
  display: none;
}
</style>